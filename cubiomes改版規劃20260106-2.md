## Cubiomes 改版規劃 20260106-2：Hillshade 高度細化

### 目標
讓 Cubiomes 版地圖的陰影細節回到「現在 mcseedmap 的視覺密度」，尤其是山脈邊界的細線與高低差。

### 推薦做法（人話）
先用大步長掃出「大概高度」，再在「剛好跨過門檻」的那一小段做二分搜尋，把高度找得更細。  
這樣可以保留正確的地形形狀，又能把鋸齒階梯感修掉。

### 為什麼推薦
- 現況問題是「高度只有每 4 或 8 格一層」，陰影就會變成塊狀。  
- 二分搜尋只在「跨過門檻」那一小段做，成本低但細節提升大。  
- 不改演算法核心，只精細化輸出高度，風險最低、最接近原版視覺。

### 詳細步驟
1) **保留 Overworld 走 deepslate，高度來源不變**
   - 仍用 `random_state.router.initialDensityWithoutJaggedness`。
   - 門檻值維持 `0.390625`（跟 deepslate 的 preliminary surface 對齊）。

2) **先做粗掃描（現況做法）**
   - `cellHeight = NoiseSettings.cellHeight(noiseSettings)`  
   - `maxY = noiseSettings.minY + noiseSettings.height`
   - 每個 grid point 從 `maxY` 往下，每次 `-cellHeight`，直到密度 > threshold。

3) **記錄跨越點**
   - 掃描時保留上一個點（`prevY` / `prevDensity`）。  
   - 當 `prevDensity <= threshold` 且 `currDensity > threshold` 時，代表高度在 `prevY` ~ `currY` 之間。

4) **在這段做二分搜尋（4~6 次即可）**
   - `low = currY`，`high = prevY`（注意 high > low）
   - 迭代：
     - `mid = (low + high) / 2`
     - `density(mid) > threshold` → `low = mid`  
       否則 `high = mid`
   - 最後 `height = low`（或 `(low+high)/2`）

5) **處理沒找到跨越點的情況**
   - 如果一路掃到底都沒有 `density > threshold`，高度固定回 `noiseSettings.minY`。  
   - 避免出現 `minY - cellHeight` 這種無效值。

6) **把細化後高度送進 worker**
   - `heightmap` 傳給 `generateBiomeImage(...)`，剩下流程不變。

### 參考偽代碼
```ts
const threshold = 0.390625
let prevY = maxY
let prevD = density(prevY)
let height = minY

for (let y = maxY - cellHeight; y >= minY; y -= cellHeight) {
  const d = density(y)
  if (prevD <= threshold && d > threshold) {
    let low = y
    let high = prevY
    for (let i = 0; i < 5; i++) {
      const mid = (low + high) * 0.5
      const dm = density(mid)
      if (dm > threshold) low = mid
      else high = mid
    }
    height = (low + high) * 0.5
    break
  }
  prevY = y
  prevD = d
}
```

### 驗收方式
- 同一 seed、同一視角（你給的截圖位置），比較：
  - 山脊線條是否回到「細密、連續」  
  - 雪地/高山邊界是否仍保留陰影層次  
  - 縮放時不出現格子化階梯

